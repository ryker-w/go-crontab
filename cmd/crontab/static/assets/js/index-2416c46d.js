import{s as g}from"./index-35ac8c1e.js";import{E as h,a as i}from"./element-plus-f169eafc.js";import{H as C,e as M,_ as P,i as j,ah as m,ar as F,o as _,c as O,V as a,P as s,a as K,T as b,Q,O as k}from"./@vue-021a4eb1.js";import"./pinia-a8c871c6.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-5dc1aa30.js";import"./js-cookie-cf83ad76.js";import"./@element-plus-4a2045cc.js";import"./nprogress-5ada7e0c.js";import"./call-bind-1df9733d.js";import"./get-intrinsic-b9397c9a.js";import"./has-symbols-e8f3ca0e.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./axios-707ed124.js";import"./qs-a8db372b.js";import"./side-channel-9112baf6.js";import"./object-inspect-d11bccf2.js";import"./mitt-f7ef348c.js";import"./lodash-es-36eb724a.js";import"./@vueuse-8a759679.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-1798568c.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-463e90e0.js";const f="/api/admin";function q(){return{list:c=>g({url:f+"/task",method:"get",params:c}),update:c=>g({url:f+"/task",method:"put",data:c}),updateSpec:c=>g({url:f+"/task/spec",method:"post",data:c}),start:c=>g({url:f+"/task/start",method:"post",data:c}),kill:c=>g({url:f+"/task/kill",method:"post",data:c}),exec:c=>g({url:f+"/task/exec",method:"post",data:c})}}const G={class:"system-dic-container layout-padding"},J={class:"system-user-search mb15"},L=C({name:"systemDic"}),Ce=C({...L,setup(c){const u=q();M();const l=P({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10}}}),n=()=>{l.tableData.loading=!0,u.list({pageNum:l.tableData.param.pageNum,pageSize:l.tableData.param.pageSize}).then(e=>{console.log(e),e.code==200&&e.items&&e.items.length>0&&(l.tableData.data=e.items,l.tableData.total=e.totalPage)}).finally(()=>{setTimeout(()=>{l.tableData.loading=!1},500)})},T=e=>{},D=e=>{console.log(e.spec,e),h.confirm(`此操作将修改任务：“${e.name}” 的定时器, 是否终止任务并继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{u.updateSpec({id:e.id,spec:e.spec}).then(t=>{t.code==200?i.success("修改成功"):i.error("格式错误")}).catch(t=>{console.log(t)}).finally(()=>{n()})}).catch(()=>{n()})},v=e=>{console.log(e.spec,e),h.confirm(`此操作将修改任务信息：“${e.name}” , 是否终止任务并继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{u.update({id:e.id,name:e.name,maxInstanceNum:parseInt(e.maxInstanceNum||"")}).then(t=>{t.code==200?i.success("修改成功"):i.error("格式错误")}).catch(t=>{console.log(t)}).finally(()=>{n()})}).catch(()=>{n()})},V=e=>{console.log(e.spec,e),h.confirm(`此操作将启动任务：“${e.name}”, 是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{u.start({id:e.id}).then(t=>{t.code==200?i.success("启动成功"):i.error("操作失败")}).catch(t=>{console.log(t)}).finally(()=>{n()})}).catch(()=>{n()})},z=e=>{console.log(e.spec,e),h.confirm(`此操作将终止任务：“${e.name}”, 是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{u.kill({id:e.id}).then(t=>{t.code==200?i.success("操作成功"):i.error("操作失败")}).catch(t=>{console.log(t)}).finally(()=>{n()})}).catch(()=>{n()})},B=e=>{if(console.log(e.spec,e),e.status==20){i.warning("任务未启用，不可执行！");return}h.prompt(`此操作将执行一次任务：“${e.name}”, 是否继续?(可填参数)`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(t=>{u.exec({id:e.id,params:t.value}).then(d=>{d.code==200?i.success("操作成功"):i.error("操作失败")}).catch(d=>{console.log(d)}).finally(()=>{n()})}).catch(()=>{n()})},N=e=>{l.tableData.param.pageSize=e,n()},S=e=>{l.tableData.param.pageNum=e,n()};return j(()=>{n()}),(e,t)=>{const d=m("el-input"),$=m("ele-Search"),y=m("el-icon"),x=m("el-button"),I=m("ele-FolderAdd"),p=m("el-table-column"),w=m("el-tag"),U=m("el-table"),A=m("el-pagination"),E=m("el-card"),H=F("loading");return _(),O("div",G,[a(E,{shadow:"hover",class:"layout-padding-auto"},{default:s(()=>[K("div",J,[a(d,{size:"default",placeholder:"请输入名称",style:{"max-width":"180px"}}),a(x,{size:"default",type:"primary",class:"ml10",onClick:t[0]||(t[0]=o=>n())},{default:s(()=>[a(y,null,{default:s(()=>[a($)]),_:1}),b(" 查询 ")]),_:1}),a(x,{size:"default",type:"success",class:"ml10",onClick:t[1]||(t[1]=o=>T("add"))},{default:s(()=>[a(y,null,{default:s(()=>[a(I)]),_:1})]),_:1})]),Q((_(),k(U,{data:l.tableData.data,style:{width:"100%"}},{default:s(()=>[a(p,{type:"index",label:"序号",width:"50"}),a(p,{prop:"clientId",label:"应用模块","show-overflow-tooltip":""}),a(p,{prop:"jobId",label:"任务ID","show-overflow-tooltip":""}),a(p,{prop:"name",label:"任务名称","show-overflow-tooltip":""},{default:s(o=>[a(d,{modelValue:o.row.name,"onUpdate:modelValue":r=>o.row.name=r,placeholder:"无",onChange:r=>v(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(p,{prop:"status",label:"状态","show-overflow-tooltip":""},{default:s(o=>[o.row.status==10?(_(),k(w,{key:0,type:"success",onClick:r=>z(o.row)},{default:s(()=>[b("启用")]),_:2},1032,["onClick"])):(_(),k(w,{key:1,type:"warning",onClick:r=>V(o.row)},{default:s(()=>[b("未启用")]),_:2},1032,["onClick"]))]),_:1}),a(p,{prop:"executorHandler",label:"任务标识","show-overflow-tooltip":""}),a(p,{prop:"spec",label:"定时器"},{default:s(o=>[a(d,{modelValue:o.row.spec,"onUpdate:modelValue":r=>o.row.spec=r,placeholder:"无",onChange:r=>D(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(p,{prop:"prevTime",label:"上次执行时间","show-overflow-tooltip":""}),a(p,{prop:"nextTime",label:"下次执行时间","show-overflow-tooltip":""}),a(p,{prop:"instanceNum",label:"当前实例量","show-overflow-tooltip":""}),a(p,{prop:"maxInstanceNum",label:"实例限制","show-overflow-tooltip":""},{default:s(o=>[a(d,{modelValue:o.row.maxInstanceNum,"onUpdate:modelValue":r=>o.row.maxInstanceNum=r,placeholder:"0",onChange:r=>v(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(p,{label:"操作",width:"100"},{default:s(o=>[a(x,{size:"small",text:"",type:"primary",onClick:r=>B(o.row)},{default:s(()=>[b("立即执行")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,l.tableData.loading]]),a(A,{onSizeChange:N,onCurrentChange:S,class:"mt15","pager-count":5,"current-page":l.tableData.param.pageNum,"onUpdate:currentPage":t[2]||(t[2]=o=>l.tableData.param.pageNum=o),background:"","page-size":l.tableData.param.pageSize,"onUpdate:pageSize":t[3]||(t[3]=o=>l.tableData.param.pageSize=o),layout:"total, prev, pager, next, jumper","page-count":l.tableData.total},null,8,["current-page","page-size","page-count"])]),_:1})])}}});export{Ce as default};
